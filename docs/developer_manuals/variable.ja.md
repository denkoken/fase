
# Variable クラス

`Variable` クラスはFaseにおけるローカル変数を扱うクラスです.

`Variable` は中にあらゆる型を内包する `std::any` の性質,
同じ実体を複数で共有する `std::shared_ptr` の性質,
からの値を持つことができる `std::optional` の性質 を持ちます.

ただし, 中に持つ値の型は
コピーコンストラクタとコピー代入演算子を持っている必要があります.

## デフォルトコンストラクタ

型として`void`を持ち値を持たない実体を作成し, それを指すインタンスとなります.

## `Variable(std::unique_ptr<T>&& ptr)` コンストラクタ

`ptr` の持つ値を持つ実体を作成し, それを指すインタンスとなります.

## `Variable(const std::type_index& type)` コンストラクタ

`type` の型を持ち値を持たない実体を作成し, それを指すインタンスとなります.

## ムーブコンストラクタ, ムーブ代入演算子

自然なムーブコンストラクタを提供します.

## `Variable::ref()`

同じ実体を指す `Variable` のインスタンスを作成します.

## `Variable::clone()`, コピーコンストラクタ

複製した実体を持つ `Variable` のインスタンスを作成します.  
元のインスタンスがさす実体と, 複製された実体は独立したものとなります.

## コピー代入演算子

複製した実体を作成し 自分の指す実体をそれに置き換えます.

## `Variable::copyTo(Variable& another)`

`another` が持つ実体の値に
自分が持つ実体の値をコピーをします（正確には コピー代入演算子を呼ぶ) .

ただし, どちらかが指す実体がを持たない場合, 処理が特殊になります.
詳細は以下の表を参照してください.

* `a.copyTo(b)`

`A`, `B` はそれぞれ, `void`以外の異なる任意の型を示します.

| `a`の型 | `b`の型 | `a`の値 | `b`の値 | 動作 |
|:---:|:---:|:---:|:---:|:---|
| `A`又は`void` | `void` | * | × | 何も起きない |
| `void` | `B` | × | * | `WrongTypeCast` を例外として投げる |
| `A` | `B` | * | * | `WrongTypeCast` を例外として投げる |
| `A` | `A` | ある | ある | `a`の値を`b`の値にコピー |
| `A` | `A` | ない | ある | `a`の値を`b`の値にコピー |
| `A` | `A` | ない | ない | 何も起きない |
| `A` | `A` | ある | ない | `a`の値を複製し,`b`のさす実体の値とする |

特に `test/test_variable.h` の `"Empry Ref : Asign"`,
`"Empry Ref : Copy"` テストで行われる挙動の違いに注意してください.

## さらに

`test/test_variable.h` を参照してください.
